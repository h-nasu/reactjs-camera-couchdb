{"version":3,"sources":["webpack:///./src/client/app/CameraComponent.jsx?300a"],"names":[],"mappings":"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","file":"0.b0d65cb8c9e8f4de45f2.hot-update.js","sourcesContent":["import React from 'react';\nimport BaseComponent from './BaseComponent.jsx';\n\nimport fetch from 'isomorphic-fetch';\n\nexport default class CameraComponent extends BaseComponent {\n  constructor(props) {\n    super(props);\n    //this.videoElement = React.createElement(\"video\");\n    //this.gotSources = this.gotSources.bind(this);\n    this._bind('_gotSources', '_successCallback', '_errorCallback', '_start', '_captureImage');\n\n\n    this.audioSelect = [];\n    this.videoSelect = [];\n    this.cimg = [];\n    this.state = {\n      videoSrc: '',\n      captures: []\n    };\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n\n    if (typeof MediaStreamTrack === 'undefined' ||\n        typeof MediaStreamTrack.getSources === 'undefined') {\n      alert('This browser does not support MediaStreamTrack.\\n\\nTry Chrome.');\n    } else {\n      MediaStreamTrack.getSources(this._gotSources);\n    }\n\n  }\n\n\n  componentDidMount() {\n    this._start()\n  }\n  \n  _gotSources(sourceInfos) {\n    for (var i = 0; i !== sourceInfos.length; ++i) {\n      var sourceInfo = sourceInfos[i];\n      if (sourceInfo.kind === 'audio') {\n        this.audioSelect.push(sourceInfo.id);\n      } else if (sourceInfo.kind === 'video') {\n        this.videoSelect.push(sourceInfo.id);\n      } else {\n        console.log('Some other kind of source: ', sourceInfo);\n      }\n    }\n  }\n\n\n  _successCallback(stream) {\n    window.stream = stream; // make stream available to console\n    this.setState({videoSrc: window.URL.createObjectURL(stream)});\n    this._video.play();\n    //console.log(this.audioSelect);\n    //console.log(this.videoSelect);\n    //this.videoElement.play();\n  }\n\n  _errorCallback(error) {\n    console.log('navigator.getUserMedia error: ', error);\n  }\n\n  _start() {\n    if (window.stream) {\n      this.state.videoSrc = null;\n      window.stream.stop();\n    }\n    var audioSource = this.audioSelect[0];\n    //var audioSource = 0;\n    var videoSource = this.videoSelect[0];\n    var constraints = {\n      audio: {\n        optional: [{\n          sourceId: audioSource\n        }]\n      },\n      video: {\n        optional: [{\n          sourceId: videoSource\n        }]\n      }\n    };\n    navigator.getUserMedia(constraints, this._successCallback, this._errorCallback);\n  }\n\n\n  _captureImage() {\n    var scale = this.props.scale;\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = this._video.videoWidth * scale;\n    canvas.height = this._video.videoHeight * scale;\n    canvas.getContext('2d')\n          .drawImage(this._video, 0, 0, canvas.width, canvas.height);\n\n    var imgSrc = canvas.toDataURL('image/jpeg');\n    const img = ()=>(<img src={imgSrc} />);\n    \n\n    var data = new FormData();\n    var uuid = new Date().toISOString();\n    //uuid = Math.random();\n    //uuid = 123;\n    data.append('file', this._dataURItoBlob(imgSrc));\n\n    fetch('http://localhost:5984/test-upload/'+uuid, {\n      method: 'put',\n      body: JSON.stringify({new:'file'})\n    }).then(this._checkStatus).then(this._parseJSON).then(\n      (resData)=>{\n        console.log(resData);\n        fetch('http://localhost:5984/test-upload/'+resData.id+'/?_rev='+resData.rev, {\n          method: 'put',\n          body: data\n        }).then(this._checkStatus).then(this._parseJSON)\n        .then( (res)=>{\n          console.log(res);\n        } ).catch( (err)=>{\n          console.log(err);\n        } );\n      }\n    );\n\n    \n\n    this.cimg.push(img);\n    this.setState({ captures: this.cimg });\n  }\n\n  render() {\n    return (\n      <div>\n        <video muted=\"true\" autoplay=\"\" ref={(r) => this._video = r} src={this.state.videoSrc}></video>\n        <button id=\"capture\" onClick={this._captureImage}>Capture</button>\n        <div id=\"output\">\n          {this.state.captures.map(function(img){\n            return img();\n          })}\n        </div>\n      </div>\n    );\n  }\n\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/client/app/CameraComponent.jsx\n **/"],"sourceRoot":""}